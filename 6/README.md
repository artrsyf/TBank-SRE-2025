# Домашнее задание № 7. SLA

## Что реализовано

### 1. oncall-prober

- Запускает HTTP-запросы к целевым сервисам (указанным в переменной окружения `PROBE_TARGETS`).
- Измеряет:
  - Доступность (успешность HTTP ответов).
  - Латентность запросов.
  - Количество ошибок.
- Экспортирует метрики Prometheus на ендпоинте `/metrics` (порт по умолчанию 9110).
- Параметры настраиваются через переменные окружения:
  - `PROBE_TARGETS` — список URL для проверки.
  - `PROBE_INTERVAL` — интервал между проверками.
  - `PROBE_TIMEOUT` — таймаут запроса.
  - `METRICS_PORT` — порт для метрик.

### 2. oncall-indicators

- Flask-сервис для вычисления SLA на основе данных из Sage.
- Периодически выполняет PQL-запросы в Sage, чтобы получить:
  - Средний процент успешных проб (`probe_up`).
  - Процент успешных HTTP-запросов.
  - Латентность P99 и её соответствие SLO.
- Рассчитывает агрегированное SLA как среднее значение вышеуказанных метрик.
- Отдает SLA в JSON-формате через ендпоинт `/sla` и в формате метрик Prometheus через ендпоинт `/metrics`.
- Настраивается через переменные окружения:
  - `PROM_URL` — URL Sage API.
  - `SAGE_TOKEN` — токен авторизации в Sage.
  - `SAGE_SOURCE`, `SAGE_GROUP`, `SAGE_SERVICE` — параметры для фильтрации метрик.
  - `SLO_LATENCY` — целевое значение по латентности.
  - `PROBE_TARGETS` — список проверяемых целей.

## Интеграция с Sage

- Все метрики, собранные `oncall-prober`, отправляются и хранятся в Sage.
- `oncall-indicators` выполняет PQL-запросы к Sage для сбора и агрегации метрик.

## Артефакты

### Примеры реализованных метрик
![alt text](<jpgs/1.png>)
![alt text](<jpgs/2.png>)
![alt text](<jpgs/3.png>)
![alt text](<jpgs/4.png>)

### Отображение SLA
![alt text](<jpgs/5.png>)